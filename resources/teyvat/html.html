<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="{{pluResPath}}/style.css">
    <link rel="preload" href="https://unpkg.com/@antv/g2plot@latest/dist/g2plot.js" as="script"/>
    <style>
        #container.火 {
            background-image: url({{miaoRes}}/common/bg/bg-pyro.webp);
        }
        div.Avatars > div.avatar > div.detail > div.talent.火 > div {
            background-image: url({{miaoRes}}/common/bg/talent-pyro.webp);
        }
        #container.水 {
            background-image: url({{miaoRes}}/common/bg/bg-hydro.webp);
        }
        div.Avatars > div.avatar > div.detail > div.talent.水 > div {
            background-image: url({{miaoRes}}/common/bg/talent-hydro.webp);
        }
        #container.风 {
            background-image: url({{miaoRes}}/common/bg/bg-anemo.webp);
        }
        div.Avatars > div.avatar > div.detail > div.talent.风 > div {
            background-image: url({{miaoRes}}/common/bg/talent-anemo.webp);
        }
        #container.雷 {
            background-image: url({{miaoRes}}/common/bg/bg-electro.webp);
        }
        div.Avatars > div.avatar > div.detail > div.talent.雷 > div {
            background-image: url({{miaoRes}}/common/bg/talent-electro.webp);
        }
        #container.草 {
            background-image: url({{miaoRes}}/common/bg/bg-dendro.webp);
        }
        div.Avatars > div.avatar > div.detail > div.talent.草 > div {
            background-image: url({{miaoRes}}/common/bg/talent-dendro.webp);
        }
        #container.冰 {
            background-image: url({{miaoRes}}/common/bg/bg-cryo.webp);
        }
        div.Avatars > div.avatar > div.detail > div.talent.冰 > div {
            background-image: url({{miaoRes}}/common/bg/talent-cryo.webp);
        }
        #container.岩 {
            background-image: url({{miaoRes}}/common/bg/bg-geo.webp);
        }
        div.Avatars > div.avatar > div.detail > div.talent.岩 > div {
            background-image: url({{miaoRes}}/common/bg/talent-geo.webp);
        }
    </style>
</head>
<body>
<div id="container" class="{{ data['elem'] }}">
    <div class="TopLeftPanel">
        <div class="UID">{{ data["uid"] }}</div>
        {{ if data["rank"].indexOf("B") !== -1 }}
        <div class="rank">
            <div class="title" style="color: rgb(255,136,0);">{{ data["rank"] }}</div>
            <div class="dps" style="color: rgb(252, 218, 166);">{{ data["dps"] }}</div>
            <div class="time" style="color: rgb(252, 218, 166);">{{ data["tm"] }}</div>
            <div class="total" style="color: rgb(252, 218, 166);">{{ data["total"] }}</div>
        </div>
        {{/if}}
        {{ if data["rank"].indexOf("A") !== -1 && data["rank"].indexOf("ACE") === -1 }}
        <div class="rank">
            <div class="title" style="color: rgb(10,227,169);">{{ data["rank"] }}</div>
            <div class="dps" style="color: rgb(172, 248, 201);">{{ data["dps"] }}</div>
            <div class="time" style="color: rgb(172, 248, 201);">{{ data["tm"] }}</div>
            <div class="total" style="color: rgb(172, 248, 201);">{{ data["total"] }}</div>
        </div>
        {{/if}}
        {{ if data["rank"].indexOf("S") !== -1 }}
        <div class="rank">
            <div class="title" style="color: rgba(239,0,255,1);">{{ data["rank"] }}</div>
            <div class="dps" style="color: rgb(251, 195, 255);">{{ data["dps"] }}</div>
            <div class="time" style="color: rgb(251, 195, 255);">{{ data["tm"] }}</div>
            <div class="total" style="color: rgb(251, 195, 255);">{{ data["total"] }}</div>
        </div>
        {{/if}}
        {{ if data["rank"].indexOf("ACE") !== -1 }}
        <div class="rank">
            <div class="title" style="color: rgba(249,0,0,1);">{{ data["rank"] }}</div>
            <div class="dps" style="color: rgb(255, 181, 181);">{{ data["dps"] }}</div>
            <div class="time" style="color: rgb(255, 181, 181);">{{ data["tm"] }}</div>
            <div class="total" style="color: rgb(255, 181, 181);">{{ data["total"] }}</div>
        </div>
        {{/if}}
        {{ if data["rank"].indexOf("A") === -1 && data["rank"].indexOf("B") === -1 && data["rank"].indexOf("S") === -1 && data["rank"].indexOf("ACE") === -1 }}
        <div class="rank">
            <div class="title" style="color: rgb(7, 126, 195);">{{ data["rank"] }}</div>
            <div class="dps" style="color: rgb(189, 218, 255);">{{ data["dps"] }}</div>
            <div class="time" style="color: rgb(189, 218, 255);">{{ data["tm"] }}</div>
            <div class="total" style="color: rgb(189, 218, 255);">{{ data["total"] }}</div>
        </div>
        {{/if}}
        <div id="pie"></div>
    </div>
    <div class="Avatars">
        {{each data["avatars"] a}}
        <div class="avatar">
            <img class="char r{{ a['rarity'] }}" src="{{ a.face }}">
            <div class="char-con c{{ a['cons'] }}"></div>
            <div class="char-lvl">{{ a["level"] }}</div>
            <img class="weapon r{{ a['weapon']['rarity'] }}" src="{{miaoRes}}/meta-gs/weapon/{{ a['weapon']['imgPath'] }}/icon.webp">
            <div class="weapon-aff a{{ a['weapon']['affix'] }}"></div>
            <div class="weapon-lvl">{{ a['weapon']['level'] }}</div>
            <div class="arti">
                {{each a["relicSet"] val key}}
                <img class="arti s{{ val }}" src="{{miaoRes}}/meta-gs/artifact/imgs/{{ key }}/1.webp" height="100%" width="100%">
                {{/each}}
            </div>
            <div class="detail">
                <div class="cp">{{ a["cp"] }}%</div>
                <div class="cd">{{ a["cd"] }}%</div>
                <div class="prop">
                    <div class="value">{{ a["key_value"] }}</div>
                    <div class="name">{{ a["key_prop"] }}</div>
                </div>
                <div style="width: 33.33%;height: 50px;font-family: PanelNumFont; position: relative; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                    <svg viewBox="0 0 25 25">
                        <circle cx="12.5" cy="12.5" r="10" stroke="#ccc" stroke-width="5" fill="none"/>
                        <circle id="{{a['name']}}" cx="12.5" cy="12.5" r="10" stroke="{{ result[a['name']]['color'] }}" stroke-width="5" fill="none" stroke-dasharray="0, 62.8" stroke-dashoffset="0" transform="rotate(-90 12.5 12.5)"/>
                        <text x="12.5" y="13.75" text-anchor="middle" font-size="8" font-weight="bold" fill="{{ result[a['name']]['color'] }}" text-shadow="0 0 5px #9370DB">{{ a["recharge"]["pct"] }}</text>
                    </svg>
                    <div style="color: #4ce878"></div>
                    <script>
                        document.getElementById("{{a['name']}}").setAttribute("stroke-dasharray", `${(50 + (parseInt("{{ a['recharge']['pct'] }}".substring(0, "{{ a['recharge']['pct'] }}".length - 1))) / 2) / 100 * (2 * Math.PI * 10)}, ${(2 * Math.PI * 10)}`);
                        document.getElementById("{{a['name']}}").setAttribute("stroke-dashoffset", (2 * Math.PI * 10) - (50 + (parseInt("{{ a['recharge']['pct'] }}".substring(0, "{{ a['recharge']['pct'] }}".length - 1))) / 2) / 100 * (2 * Math.PI * 10));
                    </script>
                </div>
                <div class="same">{{ a["recharge"]["same"] }}</div>
                <div class="diff">{{ a["recharge"]["diff"] }}</div>
                <div class="talent {{ a['elem'] }}">
                    {{each a["skills"] skill}}
                    <div>
                        <img src="{{miaoRes}}/{{skill.icon}}">
                        <span class="{{ skill['style'] }}">{{ skill["level"] }}</span>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>
        {{/each}}
    </div>
    <div class="Actions">
        <div class="title"></div>
        <div class="act">
            {{each data["actions"] action}}
            <div>{{ action }}</div>
            {{/each}}
        </div>
    </div>
    <ul class="Buffs">
        <li class="title"></li>
        {{each data["buffs"] item}}
        <li class="buff">
            <div>{{ item[0] }}</div>
            <div>{{ item[1] }}</div>
            <div>{{ item[2] }}</div>
        </li>
        {{/each}}
    </ul>
    {{ if detail }}
    <ul class="Damages">
        <li class="title"></li>
        <li class="head">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </li>
        {{each data["damages"] damage}}
        <li class="dmg">
            <div>{{ damage[0] }}</div>
            <div>{{ damage[1] }}</div>
            <div>{{ damage[2] }}</div>
            <div>{{ damage[3] }}</div>
            <div>{{ damage[4] }}</div>
        </li>
        {{/each}}
    </ul>
    {{/if}}
    <div class="copyright">
        yunzai-plugin-integration × Data from Teyvat × Prototype by Nonebot-plugin-gspanel
    </div>
</div>
</body>
<script type="text/javascript" src="{{pluResPath}}/g2plot.min.js"></script>
<script>
    const {Pie} = G2Plot;
    const Color = `{{Bing.RoleColor}}`
    const ColorArr = JSON.parse(Color.replace(/&#34;/g, '"'));
    let data = `{{RoleData}}`
    data=JSON.parse(data.replace(/&#34;/g, '"'));
    const piePlot = new Pie("pie", {
        renderer: "svg",
        animation: false,
        data: data,
        padding: [-10, 0, 20, 0],
        angleField: "damage",
        colorField: "char",
        radius: 0.8,
        color: ColorArr,
        label: {
            type: "inner",
            autoRotate: false,
            style: {
                textAlign: "center",
                fill: "#000",
                fontSize: 20,
                fontFamily: "PanelNumFont",
            },
            formatter: ({char, damage, percent}) => {
                percent = (percent * 100).toFixed(0);
                return percent > 6 ? `${char}\n${damage}W` : "";
            },
        },
        legend: false,
    });
    piePlot.render();
</script>
</html>
